"use strict";var Xe=Object.create;var X=Object.defineProperty;var et=Object.getOwnPropertyDescriptor;var tt=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,it=Object.prototype.hasOwnProperty;var st=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),ot=(s,e)=>{for(var t in e)X(s,t,{get:e[t],enumerable:!0})},ye=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of tt(e))!it.call(s,i)&&i!==t&&X(s,i,{get:()=>e[i],enumerable:!(n=et(e,i))||n.enumerable});return s};var at=(s,e,t)=>(t=s!=null?Xe(nt(s)):{},ye(e||!s||!s.__esModule?X(t,"default",{value:s,enumerable:!0}):t,s)),rt=s=>ye(X({},"__esModule",{value:!0}),s);var Qe=st(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});var b=require("obsidian"),ce="YYYY-MM-DD",pe="gggg-[W]ww",xe="YYYY-MM",Re="YYYY-[Q]Q",Oe="YYYY";function j(s){var t,n;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((n=(t=e.settings)==null?void 0:t[s])==null?void 0:n.enabled)}function q(){var s,e,t,n;try{let{internalPlugins:i,plugins:o}=window.app;if(j("daily")){let{format:g,folder:u,template:m}=((e=(s=o.getPlugin("periodic-notes"))==null?void 0:s.settings)==null?void 0:e.daily)||{};return{format:g||ce,folder:(u==null?void 0:u.trim())||"",template:(m==null?void 0:m.trim())||""}}let{folder:a,format:r,template:l}=((n=(t=i.getPluginById("daily-notes"))==null?void 0:t.instance)==null?void 0:n.options)||{};return{format:r||ce,folder:(a==null?void 0:a.trim())||"",template:(l==null?void 0:l.trim())||""}}catch(i){console.info("No custom daily note settings found!",i)}}function W(){var s,e,t,n,i,o,a;try{let r=window.app.plugins,l=(s=r.getPlugin("calendar"))==null?void 0:s.options,g=(t=(e=r.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.weekly;if(j("weekly"))return{format:g.format||pe,folder:((n=g.folder)==null?void 0:n.trim())||"",template:((i=g.template)==null?void 0:i.trim())||""};let u=l||{};return{format:u.weeklyNoteFormat||pe,folder:((o=u.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((a=u.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(r){console.info("No custom weekly note settings found!",r)}}function J(){var e,t,n,i;let s=window.app.plugins;try{let o=j("monthly")&&((t=(e=s.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.monthly)||{};return{format:o.format||xe,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom monthly note settings found!",o)}}function Q(){var e,t,n,i;let s=window.app.plugins;try{let o=j("quarterly")&&((t=(e=s.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.quarterly)||{};return{format:o.format||Re,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom quarterly note settings found!",o)}}function G(){var e,t,n,i;let s=window.app.plugins;try{let o=j("yearly")&&((t=(e=s.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.yearly)||{};return{format:o.format||Oe,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((i=o.template)==null?void 0:i.trim())||""}}catch(o){console.info("No custom yearly note settings found!",o)}}function Ve(...s){let e=[];for(let n=0,i=s.length;n<i;n++)e=e.concat(s[n].split("/"));let t=[];for(let n=0,i=e.length;n<i;n++){let o=e[n];!o||o==="."||t.push(o)}return e[0]===""&&t.unshift(""),t.join("/")}function mt(s){let e=s.substring(s.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function ht(s){let e=s.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let t=Ve(...e);window.app.vault.getAbstractFileByPath(t)||await window.app.vault.createFolder(t)}}async function Z(s,e){e.endsWith(".md")||(e+=".md");let t=b.normalizePath(Ve(s,e));return await ht(t),t}async function E(s){let{metadataCache:e,vault:t}=window.app,n=b.normalizePath(s);if(n==="/")return Promise.resolve(["",null]);try{let i=e.getFirstLinkpathDest(n,""),o=await t.cachedRead(i),a=window.app.foldManager.load(i);return[o,a]}catch(i){return console.error(`Failed to read the daily note template '${n}'`,i),new b.Notice("Failed to read the daily note template"),["",null]}}function C(s,e="day"){let t=s.clone().startOf(e).format();return`${e}-${t}`}function ze(s){return s.replace(/\[[^\]]*\]/g,"")}function ft(s,e){if(e==="week"){let t=ze(s);return/w{1,2}/i.test(t)&&(/M{1,4}/.test(t)||/D{1,4}/.test(t))}return!1}function I(s,e){return _e(s.basename,e)}function bt(s,e){return _e(mt(s),e)}function _e(s,e){let n={day:q,week:W,month:J,quarter:Q,year:G}[e]().format.split("/").pop(),i=window.moment(s,n,!0);if(!i.isValid())return null;if(ft(n,e)&&e==="week"){let o=ze(n);if(/w{1,2}/i.test(o))return window.moment(s,n.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return i}var me=class extends Error{};async function Ue(s){let e=window.app,{vault:t}=e,n=window.moment,{template:i,format:o,folder:a}=q(),[r,l]=await E(i),g=s.format(o),u=await Z(a,g);try{let m=await t.create(u,r.replace(/{{\s*date\s*}}/gi,g).replace(/{{\s*time\s*}}/gi,n().format("HH:mm")).replace(/{{\s*title\s*}}/gi,g).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(T,p,w,f,h,y)=>{let L=n(),ae=s.clone().set({hour:L.get("hour"),minute:L.get("minute"),second:L.get("second")});return w&&ae.add(parseInt(f,10),h),y?ae.format(y.substring(1).trim()):ae.format(o)}).replace(/{{\s*yesterday\s*}}/gi,s.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,s.clone().add(1,"d").format(o)));return e.foldManager.save(m,l),m}catch(m){console.error(`Failed to create file: '${u}'`,m),new b.Notice("Unable to create new file.")}}function wt(s,e){var t;return(t=e[C(s,"day")])!=null?t:null}function yt(){let{vault:s}=window.app,{folder:e}=q(),t=s.getAbstractFileByPath(b.normalizePath(e));if(!t)throw new me("Failed to find daily notes folder");let n={};return b.Vault.recurseChildren(t,i=>{if(i instanceof b.TFile){let o=I(i,"day");if(o){let a=C(o,"day");n[a]=i}}}),n}var he=class extends Error{};function vt(){let{moment:s}=window,e=s.localeData()._week.dow,t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)t.push(t.shift()),e--;return t}function Tt(s){return vt().indexOf(s.toLowerCase())}async function He(s){let{vault:e}=window.app,{template:t,format:n,folder:i}=W(),[o,a]=await E(t),r=s.format(n),l=await Z(i,r);try{let g=await e.create(l,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,m,T,p,w,f)=>{let h=window.moment(),y=s.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return T&&y.add(parseInt(p,10),w),f?y.format(f.substring(1).trim()):y.format(n)}).replace(/{{\s*title\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(u,m,T)=>{let p=Tt(m);return s.weekday(p).format(T.trim())}));return window.app.foldManager.save(g,a),g}catch(g){console.error(`Failed to create file: '${l}'`,g),new b.Notice("Unable to create new file.")}}function Pt(s,e){var t;return(t=e[C(s,"week")])!=null?t:null}function Ct(){let s={};if(!je())return s;let{vault:e}=window.app,{folder:t}=W(),n=e.getAbstractFileByPath(b.normalizePath(t));if(!n)throw new he("Failed to find weekly notes folder");return b.Vault.recurseChildren(n,i=>{if(i instanceof b.TFile){let o=I(i,"week");if(o){let a=C(o,"week");s[a]=i}}}),s}var fe=class extends Error{};async function Ye(s){let{vault:e}=window.app,{template:t,format:n,folder:i}=J(),[o,a]=await E(t),r=s.format(n),l=await Z(i,r);try{let g=await e.create(l,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,m,T,p,w,f)=>{let h=window.moment(),y=s.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return T&&y.add(parseInt(p,10),w),f?y.format(f.substring(1).trim()):y.format(n)}).replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r));return window.app.foldManager.save(g,a),g}catch(g){console.error(`Failed to create file: '${l}'`,g),new b.Notice("Unable to create new file.")}}function St(s,e){var t;return(t=e[C(s,"month")])!=null?t:null}function At(){let s={};if(!qe())return s;let{vault:e}=window.app,{folder:t}=J(),n=e.getAbstractFileByPath(b.normalizePath(t));if(!n)throw new fe("Failed to find monthly notes folder");return b.Vault.recurseChildren(n,i=>{if(i instanceof b.TFile){let o=I(i,"month");if(o){let a=C(o,"month");s[a]=i}}}),s}var be=class extends Error{};async function Ft(s){let{vault:e}=window.app,{template:t,format:n,folder:i}=Q(),[o,a]=await E(t),r=s.format(n),l=await Z(i,r);try{let g=await e.create(l,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,m,T,p,w,f)=>{let h=window.moment(),y=s.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return T&&y.add(parseInt(p,10),w),f?y.format(f.substring(1).trim()):y.format(n)}).replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r));return window.app.foldManager.save(g,a),g}catch(g){console.error(`Failed to create file: '${l}'`,g),new b.Notice("Unable to create new file.")}}function Nt(s,e){var t;return(t=e[C(s,"quarter")])!=null?t:null}function kt(){let s={};if(!We())return s;let{vault:e}=window.app,{folder:t}=Q(),n=e.getAbstractFileByPath(b.normalizePath(t));if(!n)throw new be("Failed to find quarterly notes folder");return b.Vault.recurseChildren(n,i=>{if(i instanceof b.TFile){let o=I(i,"quarter");if(o){let a=C(o,"quarter");s[a]=i}}}),s}var we=class extends Error{};async function Dt(s){let{vault:e}=window.app,{template:t,format:n,folder:i}=G(),[o,a]=await E(t),r=s.format(n),l=await Z(i,r);try{let g=await e.create(l,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,m,T,p,w,f)=>{let h=window.moment(),y=s.clone().set({hour:h.get("hour"),minute:h.get("minute"),second:h.get("second")});return T&&y.add(parseInt(p,10),w),f?y.format(f.substring(1).trim()):y.format(n)}).replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r));return window.app.foldManager.save(g,a),g}catch(g){console.error(`Failed to create file: '${l}'`,g),new b.Notice("Unable to create new file.")}}function Lt(s,e){var t;return(t=e[C(s,"year")])!=null?t:null}function Bt(){let s={};if(!Je())return s;let{vault:e}=window.app,{folder:t}=G(),n=e.getAbstractFileByPath(b.normalizePath(t));if(!n)throw new we("Failed to find yearly notes folder");return b.Vault.recurseChildren(n,i=>{if(i instanceof b.TFile){let o=I(i,"year");if(o){let a=C(o,"year");s[a]=i}}}),s}function $t(){var n,i;let{app:s}=window,e=s.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let t=s.plugins.getPlugin("periodic-notes");return t&&((i=(n=t.settings)==null?void 0:n.daily)==null?void 0:i.enabled)}function je(){var t,n;let{app:s}=window;if(s.plugins.getPlugin("calendar"))return!0;let e=s.plugins.getPlugin("periodic-notes");return e&&((n=(t=e.settings)==null?void 0:t.weekly)==null?void 0:n.enabled)}function qe(){var t,n;let{app:s}=window,e=s.plugins.getPlugin("periodic-notes");return e&&((n=(t=e.settings)==null?void 0:t.monthly)==null?void 0:n.enabled)}function We(){var t,n;let{app:s}=window,e=s.plugins.getPlugin("periodic-notes");return e&&((n=(t=e.settings)==null?void 0:t.quarterly)==null?void 0:n.enabled)}function Je(){var t,n;let{app:s}=window,e=s.plugins.getPlugin("periodic-notes");return e&&((n=(t=e.settings)==null?void 0:t.yearly)==null?void 0:n.enabled)}function Mt(s){let e={day:q,week:W,month:J,quarter:Q,year:G}[s];return e()}function Et(s,e){return{day:Ue,month:Ye,week:He}[s](e)}d.DEFAULT_DAILY_NOTE_FORMAT=ce;d.DEFAULT_MONTHLY_NOTE_FORMAT=xe;d.DEFAULT_QUARTERLY_NOTE_FORMAT=Re;d.DEFAULT_WEEKLY_NOTE_FORMAT=pe;d.DEFAULT_YEARLY_NOTE_FORMAT=Oe;d.appHasDailyNotesPluginLoaded=$t;d.appHasMonthlyNotesPluginLoaded=qe;d.appHasQuarterlyNotesPluginLoaded=We;d.appHasWeeklyNotesPluginLoaded=je;d.appHasYearlyNotesPluginLoaded=Je;d.createDailyNote=Ue;d.createMonthlyNote=Ye;d.createPeriodicNote=Et;d.createQuarterlyNote=Ft;d.createWeeklyNote=He;d.createYearlyNote=Dt;d.getAllDailyNotes=yt;d.getAllMonthlyNotes=At;d.getAllQuarterlyNotes=kt;d.getAllWeeklyNotes=Ct;d.getAllYearlyNotes=Bt;d.getDailyNote=wt;d.getDailyNoteSettings=q;d.getDateFromFile=I;d.getDateFromPath=bt;d.getDateUID=C;d.getMonthlyNote=St;d.getMonthlyNoteSettings=J;d.getPeriodicNoteSettings=Mt;d.getQuarterlyNote=Nt;d.getQuarterlyNoteSettings=Q;d.getTemplateInfo=E;d.getWeeklyNote=Pt;d.getWeeklyNoteSettings=W;d.getYearlyNote=Lt;d.getYearlyNoteSettings=G});var It={};ot(It,{default:()=>oe});module.exports=rt(It);var Ke=require("obsidian");var lt=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,re=s=>{if(typeof s!="string")throw new TypeError("Invalid argument expected string");let e=s.match(lt);if(!e)throw new Error(`Invalid argument not valid semver ('${s}' received)`);return e.shift(),e},ve=s=>s==="*"||s==="x"||s==="X",Te=s=>{let e=parseInt(s,10);return isNaN(e)?s:e},gt=(s,e)=>typeof s!=typeof e?[String(s),String(e)]:[s,e],ut=(s,e)=>{if(ve(s)||ve(e))return 0;let[t,n]=gt(Te(s),Te(e));return t>n?1:t<n?-1:0},le=(s,e)=>{for(let t=0;t<Math.max(s.length,e.length);t++){let n=ut(s[t]||"0",e[t]||"0");if(n!==0)return n}return 0};var x=(s,e)=>{let t=re(s),n=re(e),i=t.pop(),o=n.pop(),a=le(t,n);return a!==0?a:i&&o?le(i.split("."),o.split(".")):i||o?i?-1:1:0};var A=require("obsidian");var S=require("obsidian"),ge=async(s,e=!0,t="")=>{let n=`https://api.github.com/repos/${s}`;try{let i=await(0,S.request)({url:n,headers:t?{Authorization:`Token ${t}`}:{}});return(await JSON.parse(i)).private}catch(i){return e&&console.log("error in isPrivateRepo",n,i),!1}},Pe=async(s,e=!0,t="")=>{let n=`https://api.github.com/repos/${s}/releases`;try{let i=await(0,S.request)({url:n,headers:t?{Authorization:`Token ${t}`}:{}});return(await JSON.parse(i)).map(a=>({version:a.tag_name,prerelease:a.prerelease}))}catch(i){return e&&console.log("error in fetchReleaseVersions",n,i),null}},R=async(s,e,t=!0,n=!1,i="")=>{try{let o=s.assets.find(l=>l.name===e);if(!o)return null;let a={Accept:"application/octet-stream"};(n&&i||i)&&(a.Authorization=`Token ${i}`);let r=await(0,S.request)({url:o.url,headers:a});return r==="Not Found"||r==='{"error":"Not Found"}'?null:r}catch(o){return t&&console.log("error in grabReleaseFileFromRepository",URL,o),null}},Ce=async(s=!0)=>{let e="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/HEAD/community-plugins.json";try{let t=await(0,S.request)({url:e});return t==="404: Not Found"?null:await JSON.parse(t)}catch(t){return s&&console.log("error in grabCommmunityPluginList",t),null}},Se=async(s=!0)=>{let e="https://raw.githubusercontent.com/obsidianmd/obsidian-releases/HEAD/community-css-themes.json";try{let t=await(0,S.request)({url:e});return t==="404: Not Found"?null:await JSON.parse(t)}catch(t){return s&&console.log("error in grabCommmunityThemesList",t),null}},B=async(s,e=!1,t=!1)=>{let n=`https://raw.githubusercontent.com/${s}/HEAD/theme${e?"-beta":""}.css`;try{let i=await(0,S.request)({url:n});return i==="404: Not Found"?null:i}catch(i){return t&&console.log("error in grabCommmunityThemeCssFile",i),null}},Ae=async(s,e=!0)=>{let t=`https://raw.githubusercontent.com/${s}/HEAD/manifest.json`;try{let n=await(0,S.request)({url:t});return n==="404: Not Found"?null:n}catch(n){return e&&console.log("error in grabCommmunityThemeManifestFile",n),null}},dt=s=>{let e=0;for(let t=0;t<s.length;t++)e+=s.charCodeAt(t);return e},O=s=>dt(s).toString(),V=async(s,e,t)=>{let n=await B(s,e,t);return n?O(n):"0"},ct=async(s,e,t=!0)=>{let n=`https://api.github.com/repos/${s}/commits?path=${e}&page=1&per_page=1`;try{let i=await(0,S.request)({url:n});return i==="404: Not Found"?null:JSON.parse(i)}catch(i){return t&&console.log("error in grabLastCommitInfoForAFile",i),null}},Fe=async(s,e)=>{var n;let t=await ct(s,e);return t&&t.length>0&&((n=t[0].commit.committer)!=null&&n.date)?t[0].commit.committer.date:""},ue=async(s,e,t=!1,n=!1,i=!1,o)=>{var a;try{let r=e&&e!=="latest"?`https://api.github.com/repos/${s}/releases/tags/${e}`:`https://api.github.com/repos/${s}/releases`,l={Accept:"application/vnd.github.v3+json"};(i&&o||o)&&(l.Authorization=`Token ${o}`);let g=await(0,S.request)({url:r,headers:l});if(g==="404: Not Found")return null;let u=e&&e!=="latest"?[JSON.parse(g)]:JSON.parse(g);return n&&console.log(`grabReleaseFromRepository for ${s}:`,u),(a=u.sort((m,T)=>x(T.tag_name,m.tag_name)).filter(m=>t||!m.prerelease)[0])!=null?a:null}catch(r){return n&&console.log(`Error in grabReleaseFromRepository for ${s}:`,r),null}};var de={pluginList:[],pluginSubListFrozenVersion:[],themesList:[],updateAtStartup:!0,updateThemesAtStartup:!0,enableAfterInstall:!0,loggingEnabled:!1,loggingPath:"BRAT-log",loggingVerboseEnabled:!1,debuggingMode:!1,notificationsEnabled:!0,personalAccessToken:""};function Ne(s,e,t="latest",n=""){let i=!1;s.settings.pluginList.contains(e)||(s.settings.pluginList.unshift(e),i=!0),s.settings.pluginSubListFrozenVersion.filter(o=>o.repo===e).length===0&&(s.settings.pluginSubListFrozenVersion.unshift({repo:e,version:t,token:n||void 0}),i=!0),i&&s.saveSettings()}function ke(s,e){return s.settings.pluginList.contains(e)}function De(s,e,t){let n={repo:e,lastUpdate:O(t)};s.settings.themesList.unshift(n),s.saveSettings()}function Le(s,e){return!!s.settings.themesList.find(n=>n.repo===e)}function Be(s,e,t){for(let n of s.settings.themesList)n.repo===e&&(n.lastUpdate=t,s.saveSettings())}var N=require("obsidian");function z(s,e){let t=new DocumentFragment,n=document.createElement("a");if(n.textContent=s,n.href=`https://github.com/${s}`,t.appendChild(n),e){let i=document.createTextNode(e);t.appendChild(i)}return t}var ee=require("obsidian");function c(s,e,t=10,n){if(!s.settings.notificationsEnabled)return;let i=n?ee.Platform.isDesktop?"(click=dismiss, right-click=Info)":"(click=dismiss)":"",o=new ee.Notice(`BRAT
${e}
${i}`,t*1e3);n&&(o.noticeEl.oncontextmenu=()=>{n()})}var $=(s,e=!0)=>{let t=s.createEl("div");t.style.float="right",e?(t.style.padding="15px",t.style.paddingLeft="15px",t.style.paddingRight="15px",t.style.marginLeft="15px"):(t.style.padding="10px",t.style.paddingLeft="15px",t.style.paddingRight="15px");let n=t.createDiv("coffee");n.addClass("ex-twitter-span"),n.style.paddingLeft="10px";let i=n.createDiv();i.innerText="Learn more about my work at:",n.appendChild(i);let o=n.createEl("a",{href:"https://tfthacker.com"});return o.innerText="https://tfthacker.com",t};var k=class extends N.Modal{constructor(e,t,n=!1,i=!1,o="",a="",r=""){super(e.app),this.plugin=e,this.betaPlugins=t,this.address=o,this.version=a,this.privateApiKey=r,this.openSettingsTabAfterwards=n,this.useFrozenVersion=i,this.enableAfterInstall=e.settings.enableAfterInstall,this.versionSetting=null,this.addPluginButton=null}async submitForm(){if(this.address==="")return;let e=this.address.replace("https://github.com/","");e.endsWith(".git")&&(e=e.slice(0,-4));let t=this.plugin.settings.pluginSubListFrozenVersion.find(i=>i.repo===e);if(t){t.version=this.version,this.privateApiKey&&(t.token=this.privateApiKey),await this.plugin.saveSettings(),await this.betaPlugins.addPlugin(e,!1,!1,!1,this.version,!0,this.enableAfterInstall,this.privateApiKey)&&this.close();return}if(!this.version&&ke(this.plugin,e)){c(this.plugin,"This plugin is already in the list for beta testing",10);return}await this.betaPlugins.addPlugin(e,!1,!1,!1,this.version,!1,this.enableAfterInstall,this.privateApiKey)&&this.close()}updateVersionDropdown(e,t,n=""){e.clear(),e.addDropdown(i=>{i.addOption("","Select a version"),i.addOption("latest","Latest Version");for(let o of t)i.addOption(o.version,`${o.version} ${o.prerelease?"(Prerelease)":""}`);i.setValue(n),i.onChange(o=>{this.version=o,this.addPluginButton&&(this.version!==""?this.addPluginButton.setDisabled(!1):this.addPluginButton.setDisabled(!0))}),i.selectEl.style.width="100%"})}onOpen(){let e=this.contentEl.createEl("h4");this.address?(e.appendText("Change plugin version: "),e.appendChild(z(this.address))):e.setText("Github repository for beta plugin:"),this.contentEl.createEl("form",{},t=>{t.addClass("brat-modal"),(!this.address||!this.useFrozenVersion)&&new N.Setting(t).setClass("repository-setting").then(o=>{o.addText(a=>{a.setPlaceholder("Repository (example: https://github.com/GitubUserName/repository-name)"),a.setValue(this.address),a.onChange(r=>{var l,g;this.address=r.trim(),this.useFrozenVersion&&(!this.address||!this.isValidGitHubRepo(this.address))&&this.versionSetting&&(this.updateVersionDropdown(this.versionSetting,[]),this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),a.inputEl.classList.remove("valid-repository"),a.inputEl.classList.remove("invalid-repository")),this.useFrozenVersion||(this.isValidGitHubRepo(this.address)?(l=this.addPluginButton)==null||l.setDisabled(!1):(g=this.addPluginButton)==null||g.setDisabled(!0))}),a.inputEl.addEventListener("keydown",async r=>{r.key==="Enter"&&(this.address&&(this.useFrozenVersion&&this.version!==""||!this.useFrozenVersion)&&(r.preventDefault(),this.submitForm()),await this.updateVersionDropwdownEl(this.version,a))}),this.useFrozenVersion&&a.inputEl.addEventListener("blur",async()=>{await this.updateVersionDropwdownEl(this.version,a)}),a.inputEl.style.width="100%"})}),this.useFrozenVersion&&(new N.Setting(t).setClass("api-setting").addText(o=>{o.setPlaceholder("GitHub API key for private repository (optional)").setValue(this.privateApiKey).onChange(async a=>{this.privateApiKey=a.trim(),this.address&&await this.updateVersionDropwdownEl(this.version,o)}),o.inputEl.type="password",o.inputEl.style.width="100%"}),this.versionSetting=new N.Setting(t).setClass("version-setting").setClass("disabled-setting"),this.updateVersionDropdown(this.versionSetting,[],this.version),this.versionSetting.setDisabled(!0)),t.createDiv("modal-button-container",o=>{var a;o.createEl("label",{cls:"mod-checkbox"},r=>{let l=r.createEl("input",{attr:{tabindex:-1},type:"checkbox"});l.checked=this.enableAfterInstall,l.addEventListener("click",()=>{this.enableAfterInstall=l.checked}),r.appendText("Enable after installing the plugin")}),o.createEl("button",{attr:{type:"button"},text:"Never mind"}).addEventListener("click",()=>{this.close()}),this.addPluginButton=new N.ButtonComponent(o).setButtonText(this.useFrozenVersion&&this.address?"Change Version":"Add Plugin").setClass("mod-cta").onClick(r=>{var l;r.preventDefault(),this.address!==""&&(this.useFrozenVersion&&this.version!==""||!this.useFrozenVersion)&&((l=this.addPluginButton)==null||l.setDisabled(!0),this.submitForm())}),(this.useFrozenVersion||this.address==="")&&((a=this.addPluginButton)==null||a.setDisabled(!0))});let n=t.createDiv();n.style.borderTop="1px solid #ccc",n.style.marginTop="30px";let i=n.createSpan();i.innerHTML="BRAT by <a href='https://bit.ly/o42-twitter'>TFTHacker</a>",i.style.fontStyle="italic",n.appendChild(i),$(n,!1),window.setTimeout(()=>{let o=t.querySelectorAll(".brat-modal .setting-item-info");for(let a of Array.from(o))a.remove()},50),t.addEventListener("submit",o=>{var a;o.preventDefault(),this.address!==""&&(this.useFrozenVersion&&this.version!==""||!this.useFrozenVersion)&&((a=this.addPluginButton)==null||a.setDisabled(!0),this.submitForm())})}),this.address&&window.setTimeout(async()=>{await this.updateVersionDropwdownEl(this.version)},100)}async updateVersionDropwdownEl(e="",t){if(this.plugin.settings.debuggingMode&&console.log(`[BRAT] Updating version dropdown for ${this.address} with selected version ${e}`),this.useFrozenVersion&&this.address){this.versionSetting&&this.updateVersionDropdown(this.versionSetting,[],e);let n=this.address.replace("https://github.com/","");n.endsWith(".git")&&(n=n.slice(0,-4));let i=await Pe(n,this.plugin.settings.debuggingMode,this.privateApiKey||this.plugin.settings.personalAccessToken);i&&i.length>0?(t==null||t.inputEl.classList.remove("invalid-repository"),t==null||t.inputEl.classList.add("valid-repository"),this.versionSetting&&(this.versionSetting.settingEl.classList.remove("disabled-setting"),this.versionSetting.setDisabled(!1),this.updateVersionDropdown(this.versionSetting,i,e))):(t==null||t.inputEl.classList.remove("valid-repository"),t==null||t.inputEl.classList.add("invalid-repository"),this.versionSetting&&(this.versionSetting.settingEl.classList.add("disabled-setting"),this.versionSetting.setDisabled(!0),this.addPluginButton&&(this.addPluginButton.disabled=!0)))}}onClose(){this.openSettingsTabAfterwards&&(this.plugin.app.setting.open(),this.plugin.app.setting.openTabById(this.plugin.APP_ID))}isValidGitHubRepo(e){let t=e.trim().replace(/\.git$/,"");return/^(?:https:\/\/github\.com\/)?([a-zA-Z0-9._-]+)\/([a-zA-Z0-9._-]+)$/.test(t)}};var $e=require("obsidian");async function te(){try{let s=await(0,$e.requestUrl)(`https://obsidian.md/?${Math.random()}`);return s.status>=200&&s.status<300}catch(s){return!1}}var _=class{constructor(e){this.plugin=e}displayAddNewPluginModal(e=!1,t=!1,n="",i="",o=""){new k(this.plugin,this,e,t,n,i,o).open()}async validateRepository(e,t=!1,n=!1,i="",o=""){let r=await ge(e,this.plugin.settings.debuggingMode,o||this.plugin.settings.personalAccessToken),l=await ue(e,i,t,this.plugin.settings.debuggingMode,r,o||this.plugin.settings.personalAccessToken);if(!l)return n&&(c(this.plugin,`${e}
This does not seem to be an obsidian plugin with valid releases, as there are no releases available.`,15),console.error("BRAT: validateRepository",e,t,n)),null;let g=await R(l,"manifest.json",this.plugin.settings.debuggingMode,r,o||this.plugin.settings.personalAccessToken);if(!g)return n&&(c(this.plugin,`${e}
This does not seem to be an obsidian plugin, as there is no manifest.json file.`,15),console.error("BRAT: validateRepository",e,t,n)),null;let u=JSON.parse(g);return"id"in u?"version"in u?u:(n&&c(this.plugin,`${e}
The version attribute for the release is missing from the manifest file`,15),null):(n&&c(this.plugin,`${e}
The plugin id attribute for the release is missing from the manifest file`,15),null)}async getAllReleaseFiles(e,t,n,i="",o=""){let a=await ge(e,this.plugin.settings.debuggingMode,o),r=await ue(e,i,n,this.plugin.settings.debuggingMode,a,o||this.plugin.settings.personalAccessToken);if(!r)return Promise.reject("No release found");let l=n||i!=="";return console.log({reallyGetManifestOrNot:l,version:r.tag_name}),{mainJs:await R(r,"main.js",this.plugin.settings.debuggingMode,a,o||this.plugin.settings.personalAccessToken),manifest:l?await R(r,"manifest.json",this.plugin.settings.debuggingMode,a,o||this.plugin.settings.personalAccessToken):"",styles:await R(r,"styles.css",this.plugin.settings.debuggingMode,a,o||this.plugin.settings.personalAccessToken)}}async writeReleaseFilesToPluginFolder(e,t){var o,a;let n=`${(0,A.normalizePath)(`${this.plugin.app.vault.configDir}/plugins/${e}`)}/`,{adapter:i}=this.plugin.app.vault;await i.exists(n)||await i.mkdir(n),await i.write(`${n}main.js`,(o=t.mainJs)!=null?o:""),await i.write(`${n}manifest.json`,(a=t.manifest)!=null?a:""),t.styles&&await i.write(`${n}styles.css`,t.styles)}async addPlugin(e,t=!1,n=!1,i=!1,o="",a=!1,r=this.plugin.settings.enableAfterInstall,l=""){this.plugin.settings.debuggingMode&&console.log("BRAT: addPlugin",e,t,n,i,o,a,r,l?"private":"public");let g=10,u=await this.validateRepository(e,!0,!1,o,l),m=!!u;if(m||(u=await this.validateRepository(e,!1,!0,o,l)),u===null){let p=`${e}
A manifest.json file does not exist in the latest release of the repository. This plugin cannot be installed.`;return await this.plugin.log(p,!0),c(this.plugin,p,g),!1}if(!Object.hasOwn(u,"version")){let p=`${e}
The manifest.json file in the latest release or pre-release of the repository does not have a version number in the file. This plugin cannot be installed.`;return await this.plugin.log(p,!0),c(this.plugin,p,g),!1}if(!Object.hasOwn(u,"minAppVersion")&&!(0,A.requireApiVersion)(u.minAppVersion)){let p=`Plugin: ${e}

The manifest.json for this plugin indicates that the Obsidian version of the app needs to be ${u.minAppVersion}, but this installation of Obsidian is ${A.apiVersion}. 

You will need to update your Obsidian to use this plugin or contact the plugin developer for more information.`;return await this.plugin.log(p,!0),c(this.plugin,p,30),!1}let T=async()=>{let p=await this.getAllReleaseFiles(e,u,m,o,l);if(console.log("rFiles",p),(m||p.manifest==="")&&(p.manifest=JSON.stringify(u)),this.plugin.settings.debuggingMode&&console.log("BRAT: rFiles.manifest",m,p),p.mainJs===null){let w=`${e}
The release is not complete and cannot be download. main.js is missing from the Release`;return await this.plugin.log(w,!0),c(this.plugin,w,g),null}return p};if(!t||a){let p=await T();if(p===null)return!1;if(await this.writeReleaseFilesToPluginFolder(u.id,p),a||Ne(this.plugin,e,o,l),r){let{plugins:w}=this.plugin.app,f=(0,A.normalizePath)(`${w.getPluginFolder()}/${u.id}`);await w.loadManifest(f),await w.enablePluginAndSave(u.id)}if(await this.plugin.app.plugins.loadManifests(),a)await this.reloadPlugin(u.id),await this.plugin.log(`${e} reinstalled`,!0),c(this.plugin,`${e}
Plugin has been reinstalled and reloaded with version ${u.version}`,g);else{let w=o===""?"":` (version: ${o})`,f=`${e}${w}
The plugin has been registered with BRAT.`;r||(f+=" You may still need to enable it the Community Plugin List."),await this.plugin.log(f,!0),c(this.plugin,f,g)}}else{let p=`${this.plugin.app.vault.configDir}/plugins/${u.id}/`,w="";try{w=await this.plugin.app.vault.adapter.read(`${p}manifest.json`)}catch(h){if(h.errno===-4058||h.errno===-2)return await this.addPlugin(e,!1,m,!1,o,!1,r,l),!0;console.log("BRAT - Local Manifest Load",u.id,JSON.stringify(h,null,2))}if(o!==""&&o!=="latest")return c(this.plugin,`The version of ${e} is frozen, not updating.`,3),!1;let f=await JSON.parse(w);if(x(f.version,u.version)===-1){let h=await T();if(h===null)return!1;if(n){let L=`There is an update available for ${u.id} from version ${f.version} to ${u.version}. `;return await this.plugin.log(`${L}[Release Info](https://github.com/${e}/releases/tag/${u.version})`,!0),c(this.plugin,L,30,()=>{u&&window.open(`https://github.com/${e}/releases/tag/${u.version}`)}),!1}await this.writeReleaseFilesToPluginFolder(u.id,h),await this.plugin.app.plugins.loadManifests(),await this.reloadPlugin(u.id);let y=`${u.id}
Plugin has been updated from version ${f.version} to ${u.version}. `;return await this.plugin.log(`${y}[Release Info](https://github.com/${e}/releases/tag/${u.version})`,!0),c(this.plugin,y,30,()=>{u&&window.open(`https://github.com/${e}/releases/tag/${u.version}`)}),!0}return i&&c(this.plugin,`No update available for ${e}`,3),!0}return!0}async reloadPlugin(e){let{plugins:t}=this.plugin.app;try{await t.disablePlugin(e),await t.enablePlugin(e)}catch(n){this.plugin.settings.debuggingMode&&console.log("reload plugin",n)}}async updatePlugin(e,t=!1,n=!1,i=!1,o=""){let a=await this.addPlugin(e,!0,t,n,"",i,!1,o);return!a&&!t&&c(this.plugin,`${e}
Update of plugin failed.`),a}async checkForPluginUpdatesAndInstallUpdates(e=!1,t=!1){var r,l;if(!await te()){console.log("BRAT: No internet detected.");return}let n,i="Checking for plugin updates STARTED";await this.plugin.log(i,!0),e&&this.plugin.settings.notificationsEnabled&&(n=new A.Notice(`BRAT
${i}`,3e4));let o=new Map(this.plugin.settings.pluginSubListFrozenVersion.map(g=>[g.repo,{version:g.version,token:g.token}]));for(let g of this.plugin.settings.pluginList)o.has(g)&&((r=o.get(g))==null?void 0:r.version)!=="latest"||await this.updatePlugin(g,t,!1,!1,(l=o.get(g))==null?void 0:l.token);let a="Checking for plugin updates COMPLETED";await this.plugin.log(a,!0),e&&(n&&n.hide(),c(this.plugin,a,10))}deletePlugin(e){let t=`Removed ${e} from BRAT plugin list`;this.plugin.log(t,!0),this.plugin.settings.pluginList=this.plugin.settings.pluginList.filter(n=>n!==e),this.plugin.settings.pluginSubListFrozenVersion=this.plugin.settings.pluginSubListFrozenVersion.filter(n=>n.repo!==e),this.plugin.saveSettings()}getEnabledDisabledPlugins(e){let t=this.plugin.app.plugins,n=Object.values(t.manifests),i=Object.values(t.plugins).map(o=>o.manifest);return e?n.filter(o=>i.find(a=>o.id===a.id)):n.filter(o=>!i.find(a=>o.id===a.id))}};var D=require("obsidian");var U=async(s,e,t)=>{let n=await B(e,!0,s.settings.debuggingMode);if(n||(n=await B(e,!1,s.settings.debuggingMode)),!n)return c(s,"There is no theme.css or theme-beta.css file in the root path of this repository, so there is no theme to install."),!1;let i=await Ae(e,s.settings.debuggingMode);if(!i)return c(s,"There is no manifest.json file in the root path of this repository, so theme cannot be installed."),!1;let o=await JSON.parse(i),a=(0,D.normalizePath)(pt(s)+o.name),{adapter:r}=s.app.vault;await r.exists(a)||await r.mkdir(a),await r.write((0,D.normalizePath)(`${a}/theme.css`),n),await r.write((0,D.normalizePath)(`${a}/manifest.json`),i),Be(s,e,O(n));let l="";return t?(De(s,e,n),l=`${o.name} theme installed from ${e}. `,setTimeout(()=>{s.app.customCss.setTheme(o.name)},500)):l=`${o.name} theme updated from ${e}.`,s.log(`${l}[Theme Info](https://github.com/${e})`,!1),c(s,l,20,()=>{window.open(`https://github.com/${e}`)}),!0},M=async(s,e)=>{if(!await te()){console.log("BRAT: No internet detected.");return}let t,n="Checking for beta theme updates STARTED";await s.log(n,!0),e&&s.settings.notificationsEnabled&&(t=new D.Notice(`BRAT
${n}`,3e4));for(let o of s.settings.themesList){let a=await V(o.repo,!0,s.settings.debuggingMode);a==="0"&&(a=await V(o.repo,!1,s.settings.debuggingMode)),console.log("BRAT: lastUpdateOnline",a),a!==o.lastUpdate&&await U(s,o.repo,!1)}let i="Checking for beta theme updates COMPLETED";(async()=>await s.log(i,!0))(),e&&(s.settings.notificationsEnabled&&t&&t.hide(),c(s,i))},ne=(s,e)=>{s.settings.themesList=s.settings.themesList.filter(n=>n.repo!==e),s.saveSettings();let t=`Removed ${e} from BRAT themes list and will no longer be updated. However, the theme files still exist in the vault. To remove them, go into Settings > Appearance and remove the theme.`;s.log(t,!0),c(s,t)},pt=s=>`${(0,D.normalizePath)(`${s.app.vault.configDir}/themes`)}/`;var ie=require("obsidian");var F=class extends ie.Modal{constructor(e,t=!1){super(e.app),this.plugin=e,this.address="",this.openSettingsTabAfterwards=t}async submitForm(){if(this.address==="")return;let e=this.address.replace("https://github.com/","");if(Le(this.plugin,e)){c(this.plugin,"This theme is already in the list for beta testing",10);return}await U(this.plugin,e,!0)&&this.close()}onOpen(){this.contentEl.createEl("h4",{text:"Github repository for beta theme:"}),this.contentEl.createEl("form",{},e=>{e.addClass("brat-modal"),new ie.Setting(e).addText(i=>{i.setPlaceholder("Repository (example: https://github.com/GitubUserName/repository-name"),i.setValue(this.address),i.onChange(o=>{this.address=o.trim()}),i.inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&this.address!==" "&&(o.preventDefault(),this.submitForm())}),i.inputEl.style.width="100%",window.setTimeout(()=>{let o=document.querySelector(".setting-item-info");o&&o.remove(),i.inputEl.focus()},10)}),e.createDiv("modal-button-container",i=>{i.createEl("button",{attr:{type:"button"},text:"Never mind"}).addEventListener("click",()=>{this.close()}),i.createEl("button",{attr:{type:"submit"},cls:"mod-cta",text:"Add Theme"})});let t=e.createDiv();t.style.borderTop="1px solid #ccc",t.style.marginTop="30px";let n=t.createSpan();n.innerHTML="BRAT by <a href='https://bit.ly/o42-twitter'>TFTHacker</a>",n.style.fontStyle="italic",t.appendChild(n),$(t,!1),window.setTimeout(()=>{let i=e.querySelectorAll(".brat-modal .setting-item-info");for(let o of Array.from(i))o.remove()},50),e.addEventListener("submit",i=>{i.preventDefault(),this.address!==""&&this.submitForm()})})}onClose(){this.openSettingsTabAfterwards&&(this.plugin.app.setting.openTab(),this.plugin.app.setting.openTabById(this.plugin.APP_ID))}};var Me=require("obsidian"),P=class extends Me.FuzzySuggestModal{constructor(t){super(t.app);this.data=[];this.scope.register(["Shift"],"Enter",n=>{this.enterTrigger(n)}),this.scope.register(["Ctrl"],"Enter",n=>{this.enterTrigger(n)})}setSuggesterData(t){this.data=t}display(t){this.callbackFunction=t,this.open()}getItems(){return this.data}getItemText(t){return t.display}onChooseItem(){}renderSuggestion(t,n){n.createEl("div",{text:t.item.display})}enterTrigger(t){var o;let n=(o=document.querySelector(".suggestion-item.is-selected div"))==null?void 0:o.textContent,i=this.data.find(a=>a.display===n);i&&(this.invokeCallback(i,t),this.close())}onChooseSuggestion(t,n){this.invokeCallback(t.item,n)}invokeCallback(t,n){typeof this.callbackFunction=="function"&&this.callbackFunction(t,n)}};var H=class{constructor(e){this.bratCommands=[{id:"AddBetaPlugin",icon:"BratIcon",name:"Plugins: Add a beta plugin for testing (with or without version)",showInRibbon:!0,callback:()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!1,!0)}},{id:"checkForUpdatesAndUpdate",icon:"BratIcon",name:"Plugins: Check for updates to all beta plugins and UPDATE",showInRibbon:!0,callback:async()=>{await this.plugin.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!0,!1)}},{id:"checkForUpdatesAndDontUpdate",icon:"BratIcon",name:"Plugins: Only check for updates to beta plugins, but don't Update",showInRibbon:!0,callback:async()=>{await this.plugin.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!0,!0)}},{id:"updateOnePlugin",icon:"BratIcon",name:"Plugins: Choose a single plugin version to update",showInRibbon:!0,callback:()=>{let e=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(i=>i.repo)),t=Object.values(this.plugin.settings.pluginList).filter(i=>!e.has(i)).map(i=>({display:i,info:i})),n=new P(this.plugin);n.setSuggesterData(t),n.display(i=>{let o=`Checking for updates for ${i.info}`;this.plugin.log(o,!0),c(this.plugin,`
${o}`,3),this.plugin.betaPlugins.updatePlugin(i.info,!1,!0)})}},{id:"reinstallOnePlugin",icon:"BratIcon",name:"Plugins: Choose a single plugin to reinstall",showInRibbon:!0,callback:()=>{let e=new Set(this.plugin.settings.pluginSubListFrozenVersion.map(i=>i.repo)),t=Object.values(this.plugin.settings.pluginList).filter(i=>!e.has(i)).map(i=>({display:i,info:i})),n=new P(this.plugin);n.setSuggesterData(t),n.display(i=>{let o=`Reinstalling ${i.info}`;c(this.plugin,`
${o}`,3),this.plugin.log(o,!0),this.plugin.betaPlugins.updatePlugin(i.info,!1,!1,!0)})}},{id:"restartPlugin",icon:"BratIcon",name:"Plugins: Restart a plugin that is already installed",showInRibbon:!0,callback:()=>{let e=Object.values(this.plugin.app.plugins.manifests).map(n=>({display:n.id,info:n.id})),t=new P(this.plugin);t.setSuggesterData(e),t.display(n=>{c(this.plugin,`${n.info}
Plugin reloading .....`,5),this.plugin.betaPlugins.reloadPlugin(n.info)})}},{id:"disablePlugin",icon:"BratIcon",name:"Plugins: Disable a plugin - toggle it off",showInRibbon:!0,callback:()=>{let e=this.plugin.betaPlugins.getEnabledDisabledPlugins(!0).map(n=>({display:`${n.name} (${n.id})`,info:n.id})),t=new P(this.plugin);t.setSuggesterData(e),t.display(n=>{this.plugin.log(`${n.display} plugin disabled`,!1),this.plugin.settings.debuggingMode&&console.log(n.info),this.plugin.app.plugins.disablePluginAndSave(n.info)})}},{id:"enablePlugin",icon:"BratIcon",name:"Plugins: Enable a plugin - toggle it on",showInRibbon:!0,callback:()=>{let e=this.plugin.betaPlugins.getEnabledDisabledPlugins(!1).map(n=>({display:`${n.name} (${n.id})`,info:n.id})),t=new P(this.plugin);t.setSuggesterData(e),t.display(n=>{this.plugin.log(`${n.display} plugin enabled`,!1),this.plugin.app.plugins.enablePluginAndSave(n.info)})}},{id:"openGitHubZRepository",icon:"BratIcon",name:"Plugins: Open the GitHub repository for a plugin",showInRibbon:!0,callback:async()=>{let e=await Ce(this.plugin.settings.debuggingMode);if(e){let t=Object.values(e).map(o=>({display:`Plugin: ${o.name}  (${o.repo})`,info:o.repo})),n=Object.values(this.plugin.settings.pluginList).map(o=>({display:`BRAT: ${o}`,info:o}));for(let o of t)n.push(o);let i=new P(this.plugin);i.setSuggesterData(n),i.display(o=>{o.info&&window.open(`https://github.com/${o.info}`)})}}},{id:"openGitHubRepoTheme",icon:"BratIcon",name:"Themes: Open the GitHub repository for a theme (appearance)",showInRibbon:!0,callback:async()=>{let e=await Se(this.plugin.settings.debuggingMode);if(e){let t=Object.values(e).map(i=>({display:`Theme: ${i.name}  (${i.repo})`,info:i.repo})),n=new P(this.plugin);n.setSuggesterData(t),n.display(i=>{i.info&&window.open(`https://github.com/${i.info}`)})}}},{id:"opentPluginSettings",icon:"BratIcon",name:"Plugins: Open Plugin Settings Tab",showInRibbon:!0,callback:()=>{let e=this.plugin.app.setting,t=Object.values(e.pluginTabs).map(o=>({display:`Plugin: ${o.name}`,info:o.id})),n=new P(this.plugin),i=Object.values(e.settingTabs).map(o=>({display:`Core: ${o.name}`,info:o.id}));for(let o of t)i.push(o);n.setSuggesterData(i),n.display(o=>{e.open(),e.openTabById(o.info)})}},{id:"GrabBetaTheme",icon:"BratIcon",name:"Themes: Grab a beta theme for testing from a Github repository",showInRibbon:!0,callback:()=>{new F(this.plugin).open()}},{id:"updateBetaThemes",icon:"BratIcon",name:"Themes: Update beta themes",showInRibbon:!0,callback:async()=>{await M(this.plugin,!0)}},{id:"allCommands",icon:"BratIcon",name:"All Commands list",showInRibbon:!1,callback:()=>{this.ribbonDisplayCommands()}}];this.plugin=e;for(let t of this.bratCommands)this.plugin.addCommand({id:t.id,name:t.name,icon:t.icon,callback:()=>{t.callback()}})}ribbonDisplayCommands(){let e=[];for(let a of this.bratCommands)a.showInRibbon&&e.push({display:a.name,info:a.callback});let t=new P(this.plugin),n=this.plugin.app.setting,i=Object.values(n.settingTabs).map(a=>({display:`Core: ${a.name}`,info:()=>{n.open(),n.openTabById(a.id)}})),o=Object.values(n.pluginTabs).map(a=>({display:`Plugin: ${a.name}`,info:()=>{n.open(),n.openTabById(a.id)}}));e.push({display:"---- Core Plugin Settings ----",info:()=>{this.ribbonDisplayCommands()}});for(let a of i)e.push(a);e.push({display:"---- Plugin Settings ----",info:()=>{this.ribbonDisplayCommands()}});for(let a of o)e.push(a);t.setSuggesterData(e),t.display(a=>{typeof a.info=="function"&&a.info()})}};var v=require("obsidian");var se=class extends v.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new v.Setting(e).setName("Auto-enable plugins after installation").setDesc('If enabled beta plugins will be automatically enabled after installtion by default. Note: you can toggle this on and off for each plugin in the "Add Plugin" form.').addToggle(n=>{n.setValue(this.plugin.settings.enableAfterInstall),n.onChange(async i=>{this.plugin.settings.enableAfterInstall=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Auto-update plugins at startup").setDesc("If enabled all beta plugins will be checked for updates each time Obsidian starts. Note: this does not update frozen version plugins.").addToggle(n=>{n.setValue(this.plugin.settings.updateAtStartup),n.onChange(async i=>{this.plugin.settings.updateAtStartup=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Auto-update themes at startup").setDesc("If enabled all beta themes will be checked for updates each time Obsidian starts.").addToggle(n=>{n.setValue(this.plugin.settings.updateThemesAtStartup),n.onChange(async i=>{this.plugin.settings.updateThemesAtStartup=i,await this.plugin.saveSettings()})}),$(e,!0),e.createEl("hr"),new v.Setting(e).setName("Beta plugin list").setHeading(),e.createEl("div",{text:'The following is a list of beta plugins added via the command "Add a beta plugin for testing". You can chose to add the latest version or a frozen version. A frozen version is a specific release of a plugin based on its release tag.'}),e.createEl("p"),e.createEl("div",{text:"Click the 'Edit' button next to a plugin to change the installed version and the x button next to a plugin to remove it from the list."}),e.createEl("p"),e.createEl("span").createEl("b",{text:"Note: "}),e.createSpan({text:"Removing from the list does not delete the plugin, this should be done from the Community Plugins tab in Settings."}),new v.Setting(e).addButton(n=>{n.setButtonText("Add Beta plugin"),n.onClick(()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!0,!0)})});let t=new Map(this.plugin.settings.pluginSubListFrozenVersion.map(n=>[n.repo,{version:n.version,token:n.token}]));for(let n of this.plugin.settings.pluginList){let i=t.get(n),o=new v.Setting(e).setName(z(n)).setDesc(i!=null&&i.version?` Tracked version: ${i.version} ${i.version==="latest"?"":"(frozen)"}`:"");(!(i!=null&&i.version)||i.version==="latest")&&o.addButton(a=>{a.setIcon("sync").setTooltip("Check and update plugin").onClick(async()=>{let r=await this.plugin.betaPlugins.updatePlugin(n,!1,!0)})}),o.addButton(a=>{a.setIcon("edit"),a.setTooltip("Change version"),a.onClick(()=>{this.plugin.betaPlugins.displayAddNewPluginModal(!0,!0,n,i==null?void 0:i.version,i==null?void 0:i.token),this.plugin.app.setting.updatePluginSection()})}).addButton(a=>{a.setIcon("cross"),a.setTooltip("Delete this beta plugin"),a.onClick(()=>{if(a.buttonEl.textContent==="")a.setButtonText("Click once more to confirm removal");else{let{buttonEl:r}=a,{parentElement:l}=r;l!=null&&l.parentElement&&(l.parentElement.remove(),this.plugin.betaPlugins.deletePlugin(n))}})})}new v.Setting(e).setName("Beta themes list").setHeading(),new v.Setting(e).addButton(n=>{n.setButtonText("Add Beta Theme"),n.onClick(()=>{this.plugin.app.setting.close(),new F(this.plugin).open()})});for(let n of this.plugin.settings.themesList)new v.Setting(e).setName(z(n.repo)).addButton(i=>{i.setIcon("cross"),i.setTooltip("Delete this beta theme"),i.onClick(()=>{if(i.buttonEl.textContent==="")i.setButtonText("Click once more to confirm removal");else{let{buttonEl:o}=i,{parentElement:a}=o;a!=null&&a.parentElement&&(a.parentElement.remove(),ne(this.plugin,n.repo))}})});new v.Setting(e).setName("Monitoring").setHeading(),new v.Setting(e).setName("Enable Notifications").setDesc("BRAT will provide popup notifications for its various activities. Turn this off means  no notifications from BRAT.").addToggle(n=>{n.setValue(this.plugin.settings.notificationsEnabled),n.onChange(async i=>{this.plugin.settings.notificationsEnabled=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Enable Logging").setDesc("Plugin updates will be logged to a file in the log file.").addToggle(n=>{n.setValue(this.plugin.settings.loggingEnabled),n.onChange(async i=>{this.plugin.settings.loggingEnabled=i,await this.plugin.saveSettings()})}),new v.Setting(this.containerEl).setName("BRAT Log File Location").setDesc("Logs will be saved to this file. Don't add .md to the file name.").addSearch(n=>{n.setPlaceholder("Example: BRAT-log").setValue(this.plugin.settings.loggingPath).onChange(async i=>{this.plugin.settings.loggingPath=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Enable Verbose Logging").setDesc("Get a lot  more information in  the log.").addToggle(n=>{n.setValue(this.plugin.settings.loggingVerboseEnabled),n.onChange(async i=>{this.plugin.settings.loggingVerboseEnabled=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Debugging Mode").setDesc("Atomic Bomb level console logging. Can be used for troubleshoting and development.").addToggle(n=>{n.setValue(this.plugin.settings.debuggingMode),n.onChange(async i=>{this.plugin.settings.debuggingMode=i,await this.plugin.saveSettings()})}),new v.Setting(e).setName("Personal Access Token").setDesc("If you need to access private repositories, enter the personal access token here.").addText(n=>{var i;n.setPlaceholder("Enter your personal access token").setValue((i=this.plugin.settings.personalAccessToken)!=null?i:"").onChange(async o=>{this.plugin.settings.personalAccessToken=o,await this.plugin.saveSettings()})})}};var Ee=require("obsidian");function Ie(){(0,Ee.addIcon)("BratIcon",'<path fill="currentColor" stroke="currentColor"  d="M 41.667969 41.667969 C 41.667969 39.367188 39.800781 37.5 37.5 37.5 C 35.199219 37.5 33.332031 39.367188 33.332031 41.667969 C 33.332031 43.96875 35.199219 45.832031 37.5 45.832031 C 39.800781 45.832031 41.667969 43.96875 41.667969 41.667969 Z M 60.417969 58.582031 C 59.460938 58.023438 58.320312 57.867188 57.25 58.148438 C 56.179688 58.429688 55.265625 59.125 54.707031 60.082031 C 53.746094 61.777344 51.949219 62.820312 50 62.820312 C 48.050781 62.820312 46.253906 61.777344 45.292969 60.082031 C 44.734375 59.125 43.820312 58.429688 42.75 58.148438 C 41.679688 57.867188 40.539062 58.023438 39.582031 58.582031 C 37.597656 59.726562 36.910156 62.257812 38.042969 64.25 C 40.5 68.53125 45.0625 71.171875 50 71.171875 C 54.9375 71.171875 59.5 68.53125 61.957031 64.25 C 63.089844 62.257812 62.402344 59.726562 60.417969 58.582031 Z M 62.5 37.5 C 60.199219 37.5 58.332031 39.367188 58.332031 41.667969 C 58.332031 43.96875 60.199219 45.832031 62.5 45.832031 C 64.800781 45.832031 66.667969 43.96875 66.667969 41.667969 C 66.667969 39.367188 64.800781 37.5 62.5 37.5 Z M 50 8.332031 C 26.988281 8.332031 8.332031 26.988281 8.332031 50 C 8.332031 73.011719 26.988281 91.667969 50 91.667969 C 73.011719 91.667969 91.667969 73.011719 91.667969 50 C 91.667969 26.988281 73.011719 8.332031 50 8.332031 Z M 50 83.332031 C 33.988281 83.402344 20.191406 72.078125 17.136719 56.363281 C 14.078125 40.644531 22.628906 24.976562 37.5 19.042969 C 37.457031 19.636719 37.457031 20.238281 37.5 20.832031 C 37.5 27.738281 43.097656 33.332031 50 33.332031 C 52.300781 33.332031 54.167969 31.46875 54.167969 29.167969 C 54.167969 26.867188 52.300781 25 50 25 C 47.699219 25 45.832031 23.132812 45.832031 20.832031 C 45.832031 18.53125 47.699219 16.667969 50 16.667969 C 68.410156 16.667969 83.332031 31.589844 83.332031 50 C 83.332031 68.410156 68.410156 83.332031 50 83.332031 Z M 50 83.332031 " />')}var Y=class{constructor(e){this.console=(e,...t)=>{console.log(`BRAT: ${e}`,...t)};this.themes={themeseCheckAndUpates:async e=>{await M(this.plugin,e)},themeInstallTheme:async e=>{let t=e.replace("https://github.com/","");await U(this.plugin,t,!0)},themesDelete:e=>{let t=e.replace("https://github.com/","");ne(this.plugin,t)},grabCommmunityThemeCssFile:async(e,t=!1)=>await B(e,t,this.plugin.settings.debuggingMode),grabChecksumOfThemeCssFile:async(e,t=!1)=>await V(e,t,this.plugin.settings.debuggingMode),grabLastCommitDateForFile:async(e,t)=>await Fe(e,t)};this.plugin=e}};var K=require("obsidian"),Ge=at(Qe());async function Ze(s,e,t=!1){if(s.settings.debuggingMode&&console.log(`BRAT: ${e}`),s.settings.loggingEnabled){if(!s.settings.loggingVerboseEnabled&&t)return;let n=`${s.settings.loggingPath}.md`,i=`[[${(0,K.moment)().format((0,Ge.getDailyNoteSettings)().format).toString()}]] ${(0,K.moment)().format("HH:mm")}`,o=window.require("os"),a=K.Platform.isDesktop?o.hostname():"MOBILE",r=`${i} ${a} ${e.replace(`
`," ")}
`,l=s.app.vault.getAbstractFileByPath(n);l?await s.app.vault.append(l,r):l=await s.app.vault.create(n,r)}}var oe=class extends Ke.Plugin{constructor(){super(...arguments);this.APP_NAME="BRAT";this.APP_ID="obsidian42-brat";this.settings=de;this.betaPlugins=new _(this);this.commands=new H(this);this.bratApi=new Y(this);this.obsidianProtocolHandler=t=>{if(!t.plugin&&!t.theme){c(this,"Could not locate the repository from the URL.",10);return}for(let n of["plugin","theme"])if(t[n]){let i=n==="plugin"?new k(this,this.betaPlugins):new F(this);i.address=t[n],i.open();return}}}onload(){console.log(`loading ${this.APP_NAME}`),Ie(),this.addRibbonIcon("BratIcon","BRAT",()=>{this.commands.ribbonDisplayCommands()}),this.loadSettings().then(()=>{this.app.workspace.onLayoutReady(()=>{this.addSettingTab(new se(this.app,this)),this.registerObsidianProtocolHandler("brat",this.obsidianProtocolHandler),this.settings.updateAtStartup&&setTimeout(()=>{this.betaPlugins.checkForPluginUpdatesAndInstallUpdates(!1)},6e4),this.settings.updateThemesAtStartup&&setTimeout(()=>{M(this,!1)},12e4),setTimeout(()=>{window.bratAPI=this.bratApi},500)})}).catch(t=>{console.error("Failed to load settings:",t)})}async log(t,n=!1){await Ze(this,t,n)}onunload(){console.log(`unloading ${this.APP_NAME}`)}async loadSettings(){this.settings=Object.assign({},de,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */